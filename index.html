<html ng-app>
<head>

<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.0/jquery.min.js"></script>
<link href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css" rel="stylesheet" />
<script src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>

<style>

    body {
        padding-top: 20px;
    }

    .margin-base-vertical {
        margin: 40px 0;
    }

</style>

<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.2.13/angular.min.js"></script>
<script type="text/javascript">
'use strict;'

function GopherTVController($scope, $window) {

    $scope.videos = [
        // by date: sort -r
        // add some LA Gopher meetups from https://www.youtube.com/user/mikitebeka?feature=watch ?
        { date: "2014-02-27", id: "XciAOxDzqjY", tags: ["dependencies"], speakers: ["keith-rarick"], title: "Go Dependency Management" },
        { date: "2014-02-11", id: "D4CjdHllA-E", tags: ["web-services"], speakers: ["richard-crowley"], title: "Building Web Services in Go"},
        { date: "2014-02-02", id: "yvjeIZgykiA", tags: ["fosdem", "camlistore"], speakers: ["brad-fitzpatrick", "mathieu-lonjaret"], title: "[FOSDEM 2014] Camlistore"},
        { date: "2014-02-02", id: "WTRORimPvHE", tags: ["fosdem", "distributed"], speakers: ["peter-szilagyi"], title: "[FOSDEM 2014]: Iris Decentralized Messaging"},
        { date: "2014-02-02", id: "tnXOeHRuyyA", tags: ["fosdem", "porting"], speakers: ["aram-havarnanu"], title: "[FOSDEM 2014] Porting Go to New Platforms"},
        { date: "2014-02-02", id: "Qe8Dq7V3hXY", tags: ["fosdem"], speakers: ["elliott-stoneham"], title: "[FOSDEM 2014] Write your own Go compiler" },
        { date: "2014-02-02", id: "qATTTSg6zXk", tags: ["fosdem", "vitess"], speakers: ["sugu-sougoumarane"], title: "[FOSDEM 2014] Scaling with go: Youtube's Vitess"},
        { date: "2014-02-02", id: "mQ4hwLgSvUs", tags: ["fosdem", "go1.3"], speakers: ["andrew-gerrand"], title: "[FOSDEM 2014]: Looking Toward Go 1.3"},
        { date: "2014-02-02", id: "cwpI5ONWGxc", tags: ["fosdem", "lightning-talks"], speakers: [ /* todo */ ], title: "[FOSDEM 2014]: Go Lightning Talks"},
        { date: "2014-02-02", id: "8lrRIyK_dRE", tags: ["fosdem", "interfaces"], speakers: ["matthew-cottingham"], title: "[FOSDEM 2014] Interfaces: a new leaf for an old book"},
        { date: "2014-01-31", id: "wCHpytRfSL4", tags: ["music"], speakers:["francesc-campoy"], title: "Singing Gophers"},
        { date: "2014-01-24", id: "oEFqxi_n1vU", tags: ["meetup", "cassandra"], speakers: ["kyle-kingsbury", "al-tobey"], title: "Cassandra Introduction / Cassandra and Go"},
        { date: "2014-01-23", id: "BxkJRKYkUc4", tags: ["meetup", "etcd"], speakers: ["ian-eyberg", "brandon-philips"], title: "FQT: A Go Success Story / etcd" },
        { date: "2014-01-14", id: "tYe2zk5ROq4", tags: ["concurrency"], speakers: ["randall-mcpherson"], title: "Solving a Highly Concurrent Problem in Go" },
        { date: "2013-12-11", id: "elu0VpLzJL8", tags: ["python"],  speakers:["francesc-campoy"], title: "Go for Pythonistas"},
        { date: "2013-12-10", id: "wB1hoUJDbk0", tags: ["tdd"], speakers: ["francesc-campoy"], title: "TDD with Go"},
        { date: "2013-12-05", id: "5wipWZKvNSo", tags: ["emacs", "screencast"], speakers: ["dustin-sallings"], title: "five minutes of go with emacs"},
        { date: "2013-12-07", id: "3qsGpRxDGxI", tags: ["optimization"], speakers:["martin-bruse"], title: "Optimization in Go, an Informal Overview"},
        { date: "2013-11-19", id: "Hoj-Clpo9ec", tags: ["distributed"], speakers: ["rob-miller"], title: "Backpressure in Heka" },
        { date: "2013-11-06", id: "_41bkNr7eik", tags: ["optimization"],  speakers:["john-graham-cumming"], title: "Profiling Go Programs"},
        { date: "2013-10-14", id: "B97PK8PdbRE", tags: ["python"], speakers: ["francesc-campoy", "brian-dorsey"], title: "Becoming a Gopher: A Pythonista learning Go"},
        { date: "2013-09-27", id: "AR9Q6UgxEuY", tags: ["ruby"],  speakers:["lionel-barrow"], title: "Ruby and Go"},
        { date: "2013-08-23", id: "jXTh2mrqj5w", tags: ["data-science"], speakers: ["aditya-murkerjee"], title: "Go for Statistical Programming" },
        { date: "2013-08-20", id: "7BBBl8yeIw0", tags: ["mongodb"],  speakers:["sam-helman"], title: "How we use Go and MongoDB at MongoDB"},
        { date: "2013-08-08", id: "l_8z4fc-qNw", tags: ["meetup", "best-practices", "zeromq"], speakers: ["francesc-campoy", "buddy-sandidge"], title: "12 Go Best Practices / Go and ZeroMQ" },
        { date: "2013-07-23", id: "T-LJF6YOcsY", tags: ["root-access"], speakers: ["martin-gorner", "chad-fowler"], title: "root access Berlin #1: 6Wunderkinder on Go"},
        { date: "2013-07-15", id: "QDO5YOrKSiQ", tags: ["concurrency"], speakers: ["dustin-sallings"], title: "efficient parallelism with channels: the long story of go-saturate (a short story)"},
        { date: "2013-07-07", id: "sYukPc0y_Ro", tags: ["dotscale"], speakers: ["brad-fitzpatrick"], title: "dotScale 2013: Software I'm excited about"},
        { date: "2013-06-29", id: "xCH7ZaWUvDI", tags: ["meetup", "gocircuit", "nsq", "distributed"], speakers: ["matt-reiferson", "jehiah-czebotar", "petar-maymounkov"], title: "NSQ: Realtime Distributed Messaging At Scale / Go Circuit: Bottom-up Linguistic Evolution"},
        { date: "2013-06-18", id: "IkU8JsxdCAM", tags: ["meetup", "nsq", "distributed"], speakers: ["matt-reiferson", "jehiah-czebotar"], title: "NSQ: Realtime Distributed Messaging At Scale"},
        { date: "2013-06-12", id: "yue4X8rcGJU", tags: ["appengine"],  speakers:["danny-hermes", "alex-vagin"], title: "Google Cloud Endpoints on Go and PHP: An Experiment"},
        { date: "2013-06-11", id: "jE59PN4xuWo", tags: ["meetup", "interfaces"], speakers: ["mattias-hansson"], title: "From OOP to Go" },
        { date: "2013-06-11", id: "57gJA6XLDYg", tags: ["meetup", "concurrency"], speakers: ["stefan-nilsson"], title: "Go concurrently" },
        { date: "2013-05-16", id: "QDDwwePbDtw", tags: ["io", "concurrency"], speakers:["sameer-ajmani"], title: "Advanced Go concurrency"},
        { date: "2013-05-15", id: "p9VUCp98ay4", tags: ["io", "fireside-chat"], speakers:[], title: "Google I/O 2013: Fireside Chat with the Go Team"},
        { date: "2013-05-15", id: "fc25ihfXhbg", tags: ["io", "appengine"],  speakers:["david-symonds"] , title: "High Performance Apps with Go on App Engine"},
        { date: "2013-05-09", id: "USr0Bvg1ZOo", tags: ["meetup", "juju", "go1.1"], speakers:["dave-cheney", "andrew-gerrand"], title: "Go and Juju at Canonical / What's new in Go 1.1"},
        { date: "2013-04-25", id: "1X-3ekyZD9A", tags: ["meetup", "web-services", "chat-roulette", "interfaces"], speakers: ["andrew-gerrand"], title: "Go: A Simple Programming Environment / Code that Grows With Grace" },
        { date: "2013-04-23", id: "UgzIApJdLwY", tags: ["railsberry"], speakers: ["andrew-gerrand"], title: "Go: A Simple programming environment"},
        { date: "2013-03-27", id: "vUqK-0PytV4", tags: ["hangout"], speakers: ["kevin-mcdermott"], title: "Go Further" },
        { date: "2013-02-13", id: "ruw0uOC4_Xk", tags: ["hangout", "concurrency", "stathat", "tools" ], speakers: ["patrick-crosby", "phil-pennock"], title: "Go concurrency in production / Public Tools with Go" },
        { date: "2013-02-06", id: "61O6uMFzVtw", tags: ["hangout", "python"], speakers: ["kevin-mcdermott"], title: "Python to Go infosession" },
        { date: "2012-12-12", id: "5JNBPrAiqeU", tags: ["kings-of-code"], speakers: ["peter-bourgon"], title: "Kings of Code 2012: Go Do" },
        { date: "2012-11-08", id: "w8yWZks_k70", tags: ["hangout", "concurrency"], speakers: ["mark-summerfield"], title: "Programming in Go: Concurrency tips" },
        { date: "2012-11-08", id: "rDvPfSXjPQY", tags: ["hangout", "oop"], speakers: ["mark-summerfield"], title: "Programming in Go: Object Orientation" },
        { date: "2012-11-08", id: "CbDg4zeVedU", tags: ["hangout",  "function-literals"], speakers: ["mark-summerfield"], title: "Programming in Go: Function Literal Tips"},
        { date: "2012-10-26", id: "XCsL89YtqCs", tags: ["screencast"],  speakers:["andrew-gerrand"], title: "Writing, building, installing, and testing Go code"},
        { date: "2012-09-26", id: "GHaXN8G10fI", tags: [], speakers: ["brad-fitzpatrick"], title: "Airbnb Tech Talk: Go Programming Language"},
        { date: "2012-09-24", id: "iyjqL7ZqHfg", tags: ["hangout", "google-drive"], speakers:["vic-fryzel"], title: "Google Drive SDK: Writing your first Drive App in Go"},
        { date: "2012-09-08", id: "d5aHr8VGU-8", tags: ["cloud-foundry"], speakers: ["mike-gehard"], title: "Go Within Cloud Foundry"},
        { date: "2012-08-14", id: "6o5hUFmQCLE", tags: ["meetup", "juju", "go1.0"], speakers: ["dave-cheney", "andrew-gerrand", "john-barham"], title: "Go at Canonical / Using Go for fun and profit(?) / The Path to Go 1" },
        { date: "2012-08-01", id: "2KmHtgtEZ1s", tags: ["screencast"], speakers:[ "andrew-gerrand"], title: "Getting Started with Go"},
        { date: "2012-07-18", id: "bj9T2c2Xk_s", tags: ["oscon", "go1.0"], speakers: ["rob-pike", "andrew-gerrand"], title: "The Path to Go 1"},
        { date: "2012-06-29", id: "sPagpg0b7no", tags: ["io", "appengine","google-maps"], speakers: ["andrew-gerrand", "chris-broadfoot"], title: "Google I/O 2012 - Computing Map Tiles with Go on App Engine"},
        { date: "2012-06-29", id: "sln-gJaURzk", tags: ["io", "fireside-chat"], speakers:[], title: "Google I/O 2012: Meet the Go Team"},
        { date: "2012-06-29", id: "kKQLhGZVN4A", tags: ["io"], speakers: [], title: "Google I/O 2012 - Go in Production"},
        { date: "2012-06-29", id: "f6kdp27TYZs", tags: ["io", "concurrency"], speakers:[ "rob-pike"], title: "Go concurrency patterns"},
        { date: "2012-06-21", id: "JE17r3n1kz4", tags: ["meetup"], speakers:["andrew-gerrand", "rob-pike", "evan-shaw" ], title: "10 Things you (probably) don't know about Go / Writing a Shell in Go / Less is Exponentially More"},
        { date: "2012-06-20", id: "ytEkHepK08c", tags: [], speakers:[ "russ-cox"], title: "A Tour of Go"},
        { date: "2012-05-31", id: "wyJSgTEjuII", tags: ["hangout", "appengine"], speakers:["johan-euphrosine"], title: "Go + App Engine Hangout"},
        { date: "2012-05-10", id: "9kzoGaoVkqI", tags: ["hangout"],  speakers:["brad-fitzpatrick", "andrew-gerrand"], title: "Go hangout with Andrew and Brad"},
        { date: "2012-04-25", id: "4iAiS-qv26Q", tags: ["concurrency"], speakers:[ "sameer-ajmani"], title: "Let's Go Further: Build Concurrent Software using the Go Programming Language"},
        { date: "2012-04-04", id: "xjfsmKmK9qc", tags: [], speakers: ["robert-griesemer"], title: "Go in Three Easy Pieces"},
        { date: "2012-04-04", id: "on5DeUyWDqI", tags: [], speakers: ["robert-griesemer", "erik-meijer"], title: "E2E: Erik Meijer and Robert Griesemer - Going Go"},
        { date: "2012-01-11", id: "cN_DpYBzKso", tags: ["concurrency"], speakers: ["rob-pike"], title: "Concurrency is not Parallelism" },
        { date: "2011-11-16", id: "LWpm1qpWRwA", tags: ["osdc"], speakers: ["andrew-gerrand"], title: "Go: It's That Simple"},
        { date: "2011-11-01", id: "Mo1YKpIF1PQ", tags: ["appengine"], speakers: ["andrew-gerrand"], title: "Building integrated apps on Google's Cloud Platform"},
        { date: "2011-08-30", id: "HxaD_trXwRE", tags: [], speakers: ["rob-pike"], title: "Lexical Scanning in Go"},
        { date: "2011-08-30", id: "HQtLRqqB-Kk", tags: ["appengine"], speakers:[ "andrew-gerrand"], title: "Cuddle, A Go App Engine Demo"},
        { date: "2011-05-11", id: "-i0hat7pdpk", tags: ["io", "appengine"], speakers: ["rob-pike", "andrew-gerrand"], title: "Google I/O 2011: Writing Web Apps in Go"},
        { date: "2011-05-09", id: "7QDVRowyUQA", tags: ["io"], speakers: ["andrew-gerrand"], title: "I/O BootCamp 2011: Real World Go" },
        { date: "2011-02-06", id: "2-pPAvqyluI", tags: ["fosdem", "url-shortener"], speakers: ["andrew-gerrand"], title: "[FOSDEM 2011] Practical Go Programming"},
        { date: "2010-05-21", id: "jgVhBThJdXc", tags: ["io"], speakers:[ "russ-cox", "rob-pike"], title: "Google I/O 2010: Go Programming"},
        { date: "2010-04-28", id: "7VcArS4Wpqk", tags: ["historic"], speakers:[ "rob-pike"], title: "Another Go at Language Design"},
        { date: "2009-10-30", id: "rKnDgT73v8s", tags: ["historic"], speakers:[ "rob-pike"], title: "The Go Programming Language"},
    ].sort(function(a,b) { return (a.date == b.date ? 0 : (a.date < b.date ? 1 : -1 )) })

    console.log($scope.videos.length, "videos loaded")

    $scope.filterOn = function (needle, haystack) {
        return $scope.videos.filter(function(v) { return (v[haystack].indexOf(needle) >= 0) } )
    }

    $scope.getList = function (what) {
        var all = {}
        $scope.videos.forEach( function (v) {
            v[what].forEach (function (t) {
                all[t] = 1 + (all[t] || 0)
            })
        })
        var k = Object.keys(all).sort()
        return k.map(function(item) {return {item:item, count:all[item]}})
    }

    $scope.tags = $scope.getList("tags")
    $scope.speakers = $scope.getList("speakers")

    $scope.currentPlaylist = null

    $scope.sidebarVideoList = function () {
        if ($scope.currentPlaylist) {
            return $scope.currentPlaylist
        }

        if ($scope.searchText && $scope.searchText.title) {
            return $scope.videos
        }

        return null
    }

    $scope.playSomething = function(needle, haystack) {
        console.log("playing", haystack, needle)
        $scope.currentTag = needle
        if ($scope.searchText) {
		$scope.searchText.title = ''
        }

        document.location.hash=haystack+"="+needle

        var playlist = $scope.filterOn(needle, haystack)
        $scope.loadPlaylist(playlist)
    }

    $scope.loadPlaylist = function(playlist) {
        $scope.currentPlaylist = playlist
        var ytplayer = document.getElementById("ytplayer")
        var ids = playlist.map(function(v) { return v.id })
        ytplayer.cuePlaylist(ids)
        ytplayer.playVideo()
    }

    $scope.playVideo = function(id) {
        console.log("playing video", id)
        var ytplayer = document.getElementById("ytplayer")

        // if it's in our current playlist, jump there
        if ($scope.currentPlaylist) {
            $scope.currentPlaylist.forEach(function(v, k) {
                if (v.id == id) {
                    ytplayer.playVideoAt(k)
                }
            })
        }

        // not in the current playlist
        ytplayer.loadVideoById(id)
    }


    $scope.playTag = function(what) {
        $scope.playSomething(what, "tags")
    }

    $scope.playSpeaker = function(what) {
        $scope.playSomething(what, "speakers")
    }

    $scope.mostRecent = function() {
        $scope.currentTag = 'recent'
        $scope.loadPlaylist($scope.videos)
    }

    $scope.clear = function () {
        $scope.currentPlaylist = null
        $scope.currentTag = null
        document.location.hash=''
    }

    $window.onYouTubePlayerReady = function() {
        var h = document.location.hash
        var re= /^#(tags|speakers)=([-a-z]+)/
        var arr;
        if (arr = re.exec(h)) {
            console.log("grabbing playlist from hash", arr[1], "=", arr[2])
            $scope.playSomething(arr[2], arr[1])
            $scope.$apply()
        }
    }
}

</script>
</head>
<body ng-controller="GopherTVController">

<div class="container-fluid">

    <nav class="navbar navbar-default" role="navigation">
        <div class="container-fluid">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header">
                <a class="navbar-brand" href="#">GopherVids</a>
            </div>

            <ul class="nav navbar-nav navbar-left">
                <li class="dropdown">
                    <a href="" class="dropdown-toggle" data-toggle="dropdown">Tags <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                        <li ng-repeat="tag in tags">
                            <a href="" ng-click="playTag(tag.item)"><span class="badge pull-right">{{tag.count}}</span>{{tag.item}}</a>
                        </li>
                    </ul>
                </li>

                <li class="dropdown">
                    <a href="" class="dropdown-toggle" data-toggle="dropdown">Speakers <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                        <li ng-repeat="speaker in speakers">
                            <a href="" ng-click="playSpeaker(speaker.item)"><span class="badge pull-right">{{speaker.count}}</span>{{speaker.item}}</a>
                        </li>
                    </ul>
                </li>

            </ul>

            <div class="navbar-form navbar-left" role="search">
                <div class="form-group">
                    <input type="text" class="form-control" placeholder="Title Search" ng-model="searchText.title">
                </div>
            </div>

            <ul class="nav navbar-nav">
                <li><a href="" ng-click="mostRecent()">Recent</a></li>
            </ul>

            <ul class="nav navbar-nav navbar-right">
                <li><a href="https://github.com/dgryski/gophervids">Feedback?</a></li>
            </ul>
        </div>
    </nav>

	<div class="row">

        <div class="col-md-6 main">
            <object width="640" height="360">
                <param name="allowFullScreen" value="true"></param>
                <param name="allowScriptAccess" value="always"></param>
                <!-- video is "Getting Started with Go" -->
                <embed id="ytplayer" src="//www.youtube.com/v/2KmHtgtEZ1s?enablejsapi=1&version=3" type="application/x-shockwave-flash" allowfullscreen="true" allowScriptAccess="always" width="640" height="360"></embed>
            </object><br/>
        </div>

        <div class="col-md-4 sidebar">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <span ng-show="currentTag"><span ng-click="clear()" class="glyphicon glyphicon-remove"> Now playing `{{currentTag}}`</span></span>
                    <span ng-show="currentTag == null && (!searchText || !searchText.title)">No playlist selected</span>
                    <span ng-show="currentTag == null && searchText && searchText.title">Search: {{ searchText.title }}</span>
                </div>

                <div class="panel-body">
                    <div class="list-group">
                        <span ng-repeat="video in sidebarVideoList() | filter:searchText">
                            <a class="list-group-item" ng-click="playVideo(video.id)">{{video.title}}</a>
                        </span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<span id="marquee"></span>
<script type="text/javascript">
// https://twitter.com/dgryski/status/437589815177912320
if (window.location.search.match(/gophermarquee/)) {
        m = document.getElementById("marquee")
        m.innerHTML = "<marquee>gopher videos</marquee>"
}

</script>

</body>
