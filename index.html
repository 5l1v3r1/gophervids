<html ng-app>
<head>

<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.0/jquery.min.js"></script>
<link href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css" rel="stylesheet" />
<script src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>

<style>

    body {
        padding-top: 20px;
    }

    .margin-base-vertical {
        margin: 40px 0;
    }

</style>

<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.2.13/angular.min.js"></script>
<script type="text/javascript">

function GopherTVController($scope) {

    $scope.videos = [
        { id: "f6kdp27TYZs", tags: ["io", "concurrency"], speakers:[ "rob-pike"], title: "Go concurrency patterns" },
        { id: "QDDwwePbDtw", tags: ["io", "concurrency"], speakers:["sameer-ajmani"], title: "Advanced Go concurrency" },
        { id: "fc25ihfXhbg", tags: ["io", "appengine"],  speakers:["david-symonds"] , title: "High Performance Apps with Go on App Engine" },
        { id: "wyJSgTEjuII", tags: ["hangout", "appengine"], speakers:["johan-euphrosine"], title: "Go + App Engine Hangout" },
        { id: "iyjqL7ZqHfg", tags: ["hangout", "google-drive"], speakers:["vic-fryzel"], title: "Google Drive SDK: Writing your first Drive App in Go" },
        { id: "AR9Q6UgxEuY", tags: ["ruby"],  speakers:["lionel-barrow"], title: "Ruby and Go" },
        { id: "elu0VpLzJL8", tags: ["python"],  speakers:["francesc-campoy"], title: "Go for Pythonistas" },
        { id: "p9VUCp98ay4", tags: ["io", "fireside-chat"], speakers:[], title: "Google I/O 2013: Fireside Chat with the Go Team" },
        { id: "sln-gJaURzk", tags: ["io", "fireside-chat"], speakers:[], title: "Google I/O 2012: Meet the Go Team" },
        { id: "ytEkHepK08c", tags: ["intro"], speakers:[ "russ-cox"], title: "A Tour of Go" },
        { id: "HxaD_trXwRE", tags: [], speakers: ["rob-pike"], title: "Lexical Scanning in Go" },
        { id: "-i0hat7pdpk", tags: ["io", "appengine"], speakers: ["rob-pike", "andrew-gerrand"], title: "Writing Web Apps in Go" },
        { id: "jgVhBThJdXc", tags: ["intro", "io"], speakers:[ "russ-cox", "rob-pike"], title: "Go Programming" },
        { id: "wCHpytRfSL4", tags: [], speakers:["francesc-campoy"], title: "Singing Gophers" },
        { id: "4iAiS-qv26Q", tags: ["concurrency"], speakers:[ "sameer-ajmani"], title: "Let's Go Further: Build Concurrent Software using the Go Programming Language" },
        { id: "2KmHtgtEZ1s", tags: ["screencast"], speakers:[ "andrew-gerrand"], title: "Getting Started with Go" },
        { id: "7BBBl8yeIw0", tags: ["mongodb"],  speakers:["sam-helman"], title: "How we use Go and MongoDB at MongoDB" },
        { id: "_41bkNr7eik", tags: ["optimization"],  speakers:["john-graham-cumming"], title: "Profiling Go Programs" },
        { id: "XCsL89YtqCs", tags: ["screencast"],  speakers:["andrew-gerrand"], title: "Writing, building, installing, and testing Go code" },
        { id: "7VcArS4Wpqk", tags: ["historic"], speakers:[ "rob-pike"], title: "Another Go at Language Design" },
        { id: "rKnDgT73v8s", tags: ["historic"], speakers:[ "rob-pike"], title: "The Go Programming Language" },
        { id: "bj9T2c2Xk_s", tags: [], speakers: ["rob-pike", "andrew-gerrand"], title: "The Path to Go 1" },
        { id: "yue4X8rcGJU", tags: ["appengine"],  speakers:["danny-hermes", "alex-vagin"], title: "Google Cloud Endpoints on Go and PHP: An Experiment" },
        { id: "9kzoGaoVkqI", tags: ["hangout"],  speakers:["brad-fitzpatrick", "andrew-gerrand"], title: "Go hangout with Andrew and Brad" },
        { id: "GHaXN8G10fI", tags: [], speakers: ["brad-fitzpatrick"], title: "Airbnb Tech Talk: Go Programming Language" },
        { id: "HQtLRqqB-Kk", tags: ["appengine"], speakers:[ "andrew-gerrand"], title: "Cuddle, A Go App Engine Demo" },
        { id: "3qsGpRxDGxI", tags: ["optimization"], speakers:["martin-bruse"], title: "Optimization in Go, an Informal Overview" },
    ];

    $scope.filterOn = function (needle, haystack) {
        return $scope.videos.filter(function(v) { return (v[haystack].indexOf(needle) >= 0) } )
    }

    $scope.getList = function (what) {
        var all = {}
        $scope.videos.forEach( function (v) {
            v[what].forEach (function (t) {
                all[t] = 1 + (all[t] || 0)
            })
        })
        var k = Object.keys(all).sort()
        return k.map(function(item) {return {item:item, count:all[item]}})
    }

    $scope.tags = $scope.getList("tags")
    $scope.speakers = $scope.getList("speakers")

    $scope.currentPlaylist = null

    $scope.playSomething = function(needle, haystack) {
        console.log("playing", haystack, needle)
        $scope.currentTag = needle

        var ytplayer = document.getElementById("ytplayer")

        $scope.currentPlaylist = $scope.filterOn(needle, haystack)
        var ids = $scope.currentPlaylist.map(function(v) { return v.id })
        ytplayer.cuePlaylist(ids)
        ytplayer.playVideo()
    }

    $scope.playVideo = function(index) {
        var ytplayer = document.getElementById("ytplayer")
        ytplayer.playVideoAt(index)
    }

    $scope.playTag = function(what) {
        $scope.playSomething(what, "tags")
    }

    $scope.playSpeaker = function(what) {
        $scope.playSomething(what, "speakers")
    }

}

</script>
</head>
<body ng-controller="GopherTVController">

<div class="container-fluid">

    <nav class="navbar navbar-default" role="navigation">
        <div class="container-fluid">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header">
                <a class="navbar-brand" href="#">GopherVids</a>
            </div>

            <ul class="nav navbar-nav navbar-left">
                <li class="dropdown">
                    <a href="" class="dropdown-toggle" data-toggle="dropdown">Tags <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                        <li ng-repeat="tag in tags">
                            <a href="" ng-click="playTag(tag.item)"><span class="badge pull-right">{{tag.count}}</span>{{tag.item}}</a>
                        </li>
                    </ul>
                </li>

                <li class="dropdown">
                    <a href="" class="dropdown-toggle" data-toggle="dropdown">Speakers <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                        <li ng-repeat="speaker in speakers">
                            <a href="" ng-click="playSpeaker(speaker.item)"><span class="badge pull-right">{{speaker.count}}</span>{{speaker.item}}</a>
                        </li>
                    </ul>
                </li>

            </ul>

            <ul class="nav navbar-nav navbar-right">
                <li><a href="https://github.com/dgryski/gophervids">Feedback?</a></li>
            </ul>
        </div>
    </nav>


<div class="row">

        <div class="col-md-6 main">
            <object width="640" height="360">
                <param name="allowFullScreen" value="true"></param>
                <param name="allowScriptAccess" value="always"></param>
                <!-- video is "Getting Started with Go" -->
                <embed id="ytplayer" src="//www.youtube.com/v/2KmHtgtEZ1s?enablejsapi=1&version=3" type="application/x-shockwave-flash" allowfullscreen="true" allowScriptAccess="always" width="640" height="360"></embed>
            </object><br/>
        </div>

        <div class="col-md-4 sidebar">
            <span ng-hide="currentTag == null"><h4>Now Playing: `{{currentTag}}`</h4></span>
            <span ng-show="currentTag == null"><h4>No playlist selected</h4></span>
            <div class="list-group">
                <span ng-repeat="video in currentPlaylist">
                    <a class="list-group-item" ng-click="playVideo($index)">{{video.title}}</a>
                </span>
            </div>
        </div>


    </div>
</div>

</body>
